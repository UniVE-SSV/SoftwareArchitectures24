<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
		<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>CLI and Dockerfile | Software Architectures</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="CLI and Dockerfile" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Contents In the previous sections, we talked about Docker and we saw how we can download an image and launch a container. Here, we are going to explain how to interact with the Docker daemon using the Docker CLI and how we can create our custom images." />
<meta property="og:description" content="Contents In the previous sections, we talked about Docker and we saw how we can download an image and launch a container. Here, we are going to explain how to interact with the Docker daemon using the Docker CLI and how we can create our custom images." />
<link rel="canonical" href="http://localhost:4000/docker/cli-and-dockerfile/" />
<meta property="og:url" content="http://localhost:4000/docker/cli-and-dockerfile/" />
<meta property="og:site_name" content="Software Architectures" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-09-18T11:29:34+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CLI and Dockerfile" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"Article","dateModified":"2024-09-18T11:29:34+00:00","datePublished":"2024-09-18T11:29:34+00:00","description":"Contents In the previous sections, we talked about Docker and we saw how we can download an image and launch a container. Here, we are going to explain how to interact with the Docker daemon using the Docker CLI and how we can create our custom images.","headline":"CLI and Dockerfile","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/siteicon.png"}},"url":"http://localhost:4000/docker/cli-and-dockerfile/"}</script>
<!-- End Jekyll SEO tag -->

		<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Software Architectures" />

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700|Roboto:ital,wght@0,100;1,100&display=swap">
		<link rel="stylesheet" href="/css/main.css">
		<link rel="apple-touch-icon" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="/touch-icon.png" sizes="192x192">
		<link rel="icon" type="image/png" href="/images/favicon.png">

		<!-- -->
	</head>

	<body>
		<header>
			<h1>
				<a href="/"><img src="/images/emblem.svg" width="40" height="40" alt="Software Architectures logo"></a>
				Software Architectures
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav >
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/">Home</a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level current">
							
							<a href="/docker/introduction/">1. Docker</a>
							<ul>
								
									<li class="nav-item "><a href="/docker/introduction/">1. Introduction</a></li>
								
									<li class="nav-item "><a href="/docker/getting-started/">2. Getting Started</a></li>
								
									<li class="nav-item current"><a href="/docker/cli-and-dockerfile/">3. CLI and Dockerfile</a></li>
								
									<li class="nav-item "><a href="/docker/volumes/">4. Volumes</a></li>
								
							</ul>
						</li>
					
				</ul>

				<ul>
					<li class="nav-item top-level ">
						
						<a href="/changelog/"></a>
					</li>
				</ul>
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>1. Docker</h2>
				<h3>3. CLI and Dockerfile</h3>
			</div>
			<article class="content">
				<h2>Contents</h2>
<ul id="markdown-toc">
  <li><a href="#the-docker-cli" id="markdown-toc-the-docker-cli">The Docker CLI</a>    <ul>
      <li><a href="#show-all-the-downloaded-images" id="markdown-toc-show-all-the-downloaded-images">Show all the downloaded images</a></li>
      <li><a href="#download-an-image-from-the-docker-hub" id="markdown-toc-download-an-image-from-the-docker-hub">Download an image from the Docker Hub</a></li>
      <li><a href="#list-create-and-run-containers" id="markdown-toc-list-create-and-run-containers">List, create, and run containers</a></li>
      <li><a href="#build-an-image" id="markdown-toc-build-an-image">Build an image</a></li>
      <li><a href="#other-commands" id="markdown-toc-other-commands">Other commands</a></li>
    </ul>
  </li>
  <li><a href="#the-dockerfile" id="markdown-toc-the-dockerfile">The Dockerfile</a>    <ul>
      <li><a href="#run-and-cmd-whats-the-difference" id="markdown-toc-run-and-cmd-whats-the-difference">RUN and CMD: what’s the difference?</a></li>
      <li><a href="#build-the-image" id="markdown-toc-build-the-image">Build the image</a></li>
      <li><a href="#other-dockerfile-commands" id="markdown-toc-other-dockerfile-commands">Other Dockerfile commands</a></li>
    </ul>
  </li>
  <li><a href="#exercises" id="markdown-toc-exercises">Exercises</a></li>
</ul>
<p>In the previous sections, we talked about Docker and we saw how we can download an image and launch a container.<br />
Here, we are going to explain how to interact with the Docker daemon using the Docker CLI and how we can create our custom images.</p>

<h2 id="the-docker-cli">The Docker CLI</h2>
<p>The Docker Engine is shipped out with a docker CLI client application.
You can interact with docker using the <em>docker</em> command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">~/Projects/sw-arch/docker docker

Usage:  docker <span class="o">[</span>OPTIONS] COMMAND

A self-sufficient runtime <span class="k">for </span>containers

Common Commands:
  run         Create and run a new container from an image
  <span class="nb">exec        </span>Execute a <span class="nb">command </span><span class="k">in </span>a running container
  ps          List containers
  build       Build an image from a Dockerfile
  pull        Download an image from a registry
  push        Upload an image to a registry
  images      List images
  login       Log <span class="k">in </span>to a registry
  <span class="nb">logout      </span>Log out from a registry
  search      Search Docker Hub <span class="k">for </span>images
  version     Show the Docker version information
  info        Display system-wide information

Management Commands:
  builder     Manage builds
  buildx<span class="k">*</span>     Docker Buildx <span class="o">(</span>Docker Inc., v0.11.2-desktop.1<span class="o">)</span>
  compose<span class="k">*</span>    Docker Compose <span class="o">(</span>Docker Inc., v2.20.2-desktop.1<span class="o">)</span>
  container   Manage containers
  context     Manage contexts
  dev<span class="k">*</span>        Docker Dev Environments <span class="o">(</span>Docker Inc., v0.1.0<span class="o">)</span>
  extension<span class="k">*</span>  Manages Docker extensions <span class="o">(</span>Docker Inc., v0.2.20<span class="o">)</span>
  image       Manage images
  init<span class="k">*</span>       Creates Docker-related starter files <span class="k">for </span>your project <span class="o">(</span>Docker Inc., v0.1.0-beta.6<span class="o">)</span>
  manifest    Manage Docker image manifests and manifest lists
  network     Manage networks
  plugin      Manage plugins
  sbom<span class="k">*</span>       View the packaged-based Software Bill Of Materials <span class="o">(</span>SBOM<span class="o">)</span> <span class="k">for </span>an image <span class="o">(</span>Anchore Inc., 0.6.0<span class="o">)</span>
  scan<span class="k">*</span>       Docker Scan <span class="o">(</span>Docker Inc., v0.26.0<span class="o">)</span>
  scout<span class="k">*</span>      Command line tool <span class="k">for </span>Docker Scout <span class="o">(</span>Docker Inc., 0.20.0<span class="o">)</span>
  system      Manage Docker
  trust       Manage trust on Docker images
  volume      Manage volumes

Swarm Commands:
  swarm       Manage Swarm

Commands:
  attach      Attach <span class="nb">local </span>standard input, output, and error streams to a running container
  commit      Create a new image from a container<span class="s1">'s changes
  cp          Copy files/folders between a container and the local filesystem
  create      Create a new container
  diff        Inspect changes to files or directories on a container'</span>s filesystem
  events      Get real <span class="nb">time </span>events from the server
  <span class="nb">export      </span>Export a container<span class="s1">'s filesystem as a tar archive
  history     Show the history of an image
  import      Import the contents from a tarball to create a filesystem image
  inspect     Return low-level information on Docker objects
  kill        Kill one or more running containers
  load        Load an image from a tar archive or STDIN
  logs        Fetch the logs of a container
  pause       Pause all processes within one or more containers
  port        List port mappings or a specific mapping for the container
  rename      Rename a container
  restart     Restart one or more containers
  rm          Remove one or more containers
  rmi         Remove one or more images
  save        Save one or more images to a tar archive (streamed to STDOUT by default)
  start       Start one or more stopped containers
  stats       Display a live stream of container(s) resource usage statistics
  stop        Stop one or more running containers
  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE
  top         Display the running processes of a container
  unpause     Unpause all processes within one or more containers
  update      Update configuration of one or more containers
  wait        Block until one or more containers stop, then print their exit codes

Global Options:
      --config string      Location of client config files (default "/Users/giacomo/.docker")
  -c, --context string     Name of the context to use to connect to the daemon (overrides DOCKER_HOST env var and default context set with "docker context use")
  -D, --debug              Enable debug mode
  -H, --host list          Daemon socket to connect to
  -l, --log-level string   Set the logging level ("debug", "info", "warn", "error", "fatal") (default "info")
      --tls                Use TLS; implied by --tlsverify
      --tlscacert string   Trust certs signed only by this CA (default "/Users/giacomo/.docker/ca.pem")
      --tlscert string     Path to TLS certificate file (default "/Users/giacomo/.docker/cert.pem")
      --tlskey string      Path to TLS key file (default "/Users/giacomo/.docker/key.pem")
      --tlsverify          Use TLS and verify the remote
  -v, --version            Print version information and quit

Run '</span>docker COMMAND <span class="nt">--help</span><span class="s1">' for more information on a command.

For more help on how to use Docker, head to https://docs.docker.com/go/guides/</span></code></pre></figure>

<p>Docker CLI commands are self-explanatory: however, we will see briefly the most important ones.</p>
<h3 id="show-all-the-downloaded-images">Show all the downloaded images</h3>
<p>You can get a list of all the images that you have downloaded with the command <strong>docker images</strong> (or <strong>docker image ls</strong>):</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">~/Projects/sw-arch/docker docker images
REPOSITORY               TAG       IMAGE ID       CREATED        SIZE
golang                   latest    57ca605b665e   12 hours ago   814MB
httpd                    latest    7860e7628717   31 hours ago   168MB
docker/getting-started   latest    3e4394f6b72f   8 months ago   47MB</code></pre></figure>

<h3 id="download-an-image-from-the-docker-hub">Download an image from the Docker Hub</h3>
<p>What about downloading an image? Just type <b>docker pull <em>&lt;name-of-image:tag&gt;</em></b> (example: <strong>docker pull nodejs:latest</strong>).<br />
Tag permits you to specify which version of the Docker image you want to use. If you don’t specify a tag, the latest available image will be pulled.
You can see all the available tags for an image directly from the Docker Hub (for example, for node: <a target="_blank" rel="noopener noreferrer" href="https://hub.docker.com/_/node/tags">hub.docker.com/_/node/tags</a>).</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">~/Projects/sw-arch/docker docker pull node:latest
latest: Pulling from library/node
012c0b3e998c: Already exists 
00046d1e755e: Already exists 
9f13f5a53d11: Already exists 
e13e76ad6279: Pull <span class="nb">complete 
</span>95103e803d28: Pull <span class="nb">complete 
</span>c3ef23edee6c: Pull <span class="nb">complete 
</span>cde810d34647: Pull <span class="nb">complete 
</span>cfeacc2c3f89: Pull <span class="nb">complete 
</span>Digest: sha256:69cf8e7dcc78e63db74ca6ed570e571e41029accdac21b219b6ac57e9aca63cf
Status: Downloaded newer image <span class="k">for </span>node:latest
docker.io/library/node:latest

What<span class="s1">'s Next?
  View summary of image vulnerabilities and recommendations → docker scout quickview node:latest
~/Projects/sw-arch/docker docker images
REPOSITORY               TAG       IMAGE ID       CREATED        SIZE
node                     latest    add6f751ed2b   11 hours ago   1.1GB
golang                   latest    57ca605b665e   13 hours ago   814MB
httpd                    latest    7860e7628717   32 hours ago   168MB
docker/getting-started   latest    3e4394f6b72f   8 months ago   47MB
~/Projects/sw-arch/docker </span></code></pre></figure>

<p>As we mentioned before, an image is composed of layers, that are images themselves. When you download an image, you download the layers that compose that image and this is visible by the logs of the docker pull command (i.e., 012c0b3e998c, 00046d1e755e, 9f13f5a53d11 are the first three layers that compose this image). This permits you to avoid redownloading a layer if you have already pulled it for another image. In the example above, we have that the first three layers already exist locally, so Docker skips the download of these layers.</p>

<p>The downloaded image is then visible inside Docker Desktop:
<img src="/images/docker_cli_1.png" alt="Docker images" /></p>

<h3 id="list-create-and-run-containers">List, create, and run containers</h3>
<p>To create a container from an image, you can use the docker create command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">~/Projects/sw-arch/docker docker create <span class="nt">-p</span> 8080:80 httpd 
597372a315efb6465d2900a2cabb7b570b6cee884cf87781927443365435cd75</code></pre></figure>

<p>With the -p flag you can specify the port mapping: in the example, we map port 8080 of the host to port 80 in the container.
<img src="/images/docker_cli_2.png" alt="Docker images" />
If you want to see all the available containers in your docker environment, you can use docker ps -a command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">~/Projects/sw-arch/docker docker ps <span class="nt">-a</span>
CONTAINER ID   IMAGE                           COMMAND                  CREATED          STATUS                       PORTS                  NAMES
597372a315ef   httpd                           <span class="s2">"httpd-foreground"</span>       50 seconds ago   Created                                             tender_banzai
7e1bd280a489   node:18                         <span class="s2">"docker-entrypoint.s…"</span>   3 days ago       Exited <span class="o">(</span>0<span class="o">)</span> 3 days ago                               happy_lalande
c9338f41f0dc   docker/getting-started          <span class="s2">"/docker-entrypoint.…"</span>   3 days ago       Exited <span class="o">(</span>255<span class="o">)</span> 6 minutes ago   0.0.0.0:80-&gt;80/tcp     great_lehmann
7d7fb37297b2   docker/getting-started:latest   <span class="s2">"/docker-entrypoint.…"</span>   4 days ago       Up About a minute            0.0.0.0:1234-&gt;80/tcp   romantic_elgamal
c39fccc5e710   docker/getting-started:latest   <span class="s2">"/docker-entrypoint.…"</span>   4 days ago       Exited <span class="o">(</span>0<span class="o">)</span> 3 days ago  
~/Projects/sw-arch/docker</code></pre></figure>

<p>To start a container, you can use the docker start command, passing the ID of the desired container:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">~/Projects/sw-arch/docker docker start 597372a315ef 
597372a315ef
~/Projects/sw-arch/docker</code></pre></figure>

<p>You can also create and start a container in a single step, by using docker run:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">~/Projects/sw-arch/docker docker run <span class="nt">-d</span> <span class="nt">-p</span> 8081:80 httpd 
5a3280c5fc90340419f8f17603580e1c46fb5349a786f0ff837908f0ccfb623b</code></pre></figure>

<h3 id="build-an-image">Build an image</h3>
<p>We can use the docker build command to build an image. We will explain this command in the next section.</p>
<h3 id="other-commands">Other commands</h3>
<p>An exhaustive list of all the Docker CLI commands can be found <a target="_blank" rel="noopener noreferrer" href="https://docs.docker.com/engine/reference/commandline/cli/">here</a>..</p>
<h2 id="the-dockerfile">The Dockerfile</h2>
<p>But how we can create an image from scratch? In Docker exists a special file, called Dockerfile, that permits the definition of an image in a script way. Let’s see how it works.
The first step involves creating a new text file named Dockerfile, without extension. In this file, we are going to describe all the step-by-step commands that the Docker Engine needs to run to assemble a Docker image.<br />
We are going to explain how a Dockerfile works by looking at the getting started web application. <br />
So, start the container previously created from the docker/getting-started image (or create a new one from that image) and go to the web app. 
Follow the first steps (Getting your app). Then, inside the app folder, create an empty file named Dockerfile and insert the following lines:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">FROM node:18-alpine
WORKDIR /app
COPY <span class="nb">.</span> <span class="nb">.</span>
RUN yarn <span class="nb">install</span> <span class="nt">--production</span>
CMD <span class="o">[</span><span class="s2">"node"</span>, <span class="s2">"src/index.js"</span><span class="o">]</span></code></pre></figure>

<p>What do these commands mean? Let’s see one by one.</p>
<ol>
  <li><code class="language-plaintext highlighter-rouge">FROM node:18-alpine</code>: as you can notice, we downloaded a node application. The FROM command tells us the base image: in this case, since we are dealing with a node app, we want to start with a node image.</li>
  <li><code class="language-plaintext highlighter-rouge">WORKDIR /app</code>: this says that the default working directory for the next commands is the /app folder. If the folder does not exist in the image, this command will create it.</li>
  <li><code class="language-plaintext highlighter-rouge">COPY . .</code>: this command permits us to copy files from our machine to the Docker image. The syntax is COPY <src> <dest>, in our case, the src is the current folder of our host, and the destination is the current workdir of the image that we are going to create.</dest></src></li>
  <li><code class="language-plaintext highlighter-rouge">RUN yarn install --production</code>: this commands launch yarn. yarn is a package manager for node, it permits the installation of all the necessary external dependencies for our project, defined inside the package.json file.</li>
  <li><code class="language-plaintext highlighter-rouge">CMD ["node", "src/index.js"]</code>: tells what command needs to be launched when we start a container created from the current image. For our case, we are going to start the node server.
    <h3 id="run-and-cmd-whats-the-difference">RUN and CMD: what’s the difference?</h3>
    <p>RUN and CMD commands seem very similar. The main difference is that RUN is an image-build step. That is to say, all commands launched with RUN will be persistent in the image. We could have multiple RUN commands in a Dockerfile, and these commands are layered on top of one another to build the final image.<br />
CMD, instead, is the command launched by default when we start the container. The Dockerfile will just use the last CMD defined.<br />
In other words: CMD commands will be executed once during the creation of the image. The RUN command will be executed every time we start a container.</p>
    <h3 id="build-the-image">Build the image</h3>
    <p>To build the image we use the docker build command. Go into the folder in which the Dockerfile lives and launch the next command:</p>
  </li>
</ol>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">docker build <span class="nt">-t</span> simple-node-app .</code></pre></figure>

<p>This command creates a new image executing the commands specified in the Dockerfile: first, it will fetch the node:18-alpine image from the web. Then, it will copy the application inside the /app folder with the COPY command and then it will run yarn to install all the dependencies.
The -t flag permits to tag and name the image.<br />
The last point (.) at the end of the command tells Docker to fetch the Dockerfile from the current directory.<br />
Now, if you open Docker Desktop, you should see the newly created image:
<img src="/images/docker_cli_3.png" alt="Docker images" />
Create and run a container for our image:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">docker run <span class="nt">-d</span> <span class="nt">-p</span> 3200:3000 simple-node-app</code></pre></figure>

<p>With the flag -d we are going to tell Docker to run the container in detached mode, while with -p we can specify the port mapping: in our case, we are mapping the 3200 port of our host to port 3000 of the container.
The application is then avaiable at <a target="_blank" rel="noopener noreferrer" href="localhost:3200">localhost:3200</a>:
<img src="/images/docker_cli_4.png" alt="Docker images" /></p>
<h3 id="other-dockerfile-commands">Other Dockerfile commands</h3>
<p>Here we see briefly two other important Dockerfile commands: a complete list can be found <a target="_blank" rel="noopener noreferrer" href="https://docs.docker.com/engine/reference/builder/">here</a>.</p>
<ol>
  <li><strong>EXPOSE</strong>: informs Docker that the container listens on specified network ports at runtime, and permits to specify also if the port listens on TCP or UDP protocol (default TCP if the protocol is omitted). For example:</li>
</ol>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">EXPOSE 80/udp
EXPOSE 80/tcp
EXPOSE 40</code></pre></figure>

<p>This tells that the container listens on port 80 both in UDP and TCP, and on port 40 in TCP.</p>
<ol>
  <li><strong>ENV</strong>: sets an environment variable in the container. For example, try to create this Docker image:</li>
</ol>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">FROM ubuntu
ENV <span class="nv">TEST_ENV_VAR</span><span class="o">=</span><span class="s2">"HELLO WORLD"</span>
CMD <span class="o">[</span><span class="s2">"sleep"</span>, <span class="s2">"3600"</span><span class="o">]</span></code></pre></figure>

<p>And run a container from it. Then, open the container’s terminal and print out the content of the environment variable TEST_ENV_VAR:
<img src="/images/docker_cli_5.png" alt="Docker images" /></p>
<h2 id="exercises">Exercises</h2>
<ol>
  <li>Create a <strong>Dockerfile</strong> that prints “installing!” when it is installed and prints “running!” each time it is launched.</li>
</ol>
<div>
Previous: <a href="/SoftwareArchitectures24/docker/getting-started">Docker - Getting Started</a>
</div>
<div>
Next: <a href="/SoftwareArchitectures24/docker/volumes">Docker - Volumes</a>  
</div>

			</article>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
